<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Dashboard - Dynamic</title>
    <style>
        body{font-family:Arial;background:linear-gradient(135deg,#667eea,#764ba2);color:#333;margin:0;padding:20px}
        .container{max-width:800px;margin:0 auto}
        header{background:rgba(255,255,255,0.9);border-radius:10px;padding:20px;margin-bottom:20px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        h1{color:#4a5568;font-size:2em;margin:10px 0}
        .nav{display:flex;justify-content:center;gap:10px;margin-top:15px}
        .btn{background:#4299e1;color:white;padding:10px 20px;text-decoration:none;border-radius:20px}
        .btn:hover{background:#3182ce}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:20px}
        .card{background:rgba(255,255,255,0.9);border-radius:10px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        .card h2{color:#2d3748;margin-bottom:15px;border-bottom:2px solid #4299e1;padding-bottom:5px}
        .metric{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #e2e8f0}
        .metric:last-child{border-bottom:none}
        .value{font-weight:bold;color:#4299e1}
        .online{color:#48bb78;font-weight:bold}
        .ctrl-btn{background:#48bb78;color:white;border:none;padding:8px 16px;border-radius:15px;cursor:pointer;margin:3px;font-size:13px}
        .ctrl-btn:hover{background:#38a169}
        .danger{background:#f56565}
        .danger:hover{background:#e53e3e}
        .loading{opacity:0.6}
        .status-indicator{
            display:inline-block;
            width:10px;
            height:10px;
            border-radius:50%;
            margin-right:5px;
        }
        .status-online{background-color:#48bb78}
        .status-offline{background-color:#f56565}
        .auto-refresh{
            position:fixed;
            top:20px;
            right:20px;
            background:rgba(255,255,255,0.9);
            padding:10px;
            border-radius:10px;
            box-shadow:0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ESP32 Webserver Dashboard</h1>
            <p>Real-time System Monitor & Control Panel</p>
            <nav class="nav">
                <a href="/" class="btn">Home</a>
                <a href="/index" class="btn">Index</a>
                <a href="/login" class="btn">Login</a>
                <a href="/logout" class="btn">Logout</a>
            </nav>
        </header>

        <div class="auto-refresh">
            <label>
                <input type="checkbox" id="autoRefresh" checked> Auto-refresh (5s)
            </label>
            <button onclick="refreshAllData()" class="btn" style="padding:5px 10px;font-size:12px;margin-left:10px">Refresh Now</button>
        </div>

        <div class="grid">
            <div class="card">
                <h2>System Status</h2>
                <div id="systemMetrics">
                    <div class="metric"><span>Device Status</span><span class="value" id="deviceStatus">Loading...</span></div>
                    <div class="metric"><span>WiFi Connection</span><span class="value" id="wifiStatus">Loading...</span></div>
                    <div class="metric"><span>Uptime</span><span class="value" id="uptime">Loading...</span></div>
                    <div class="metric"><span>Free Memory</span><span class="value" id="freeMemory">Loading...</span></div>
                    <div class="metric"><span>CPU Usage</span><span class="value" id="cpuUsage">Loading...</span></div>
                    <div class="metric"><span>Temperature</span><span class="value" id="systemTemp">Loading...</span></div>
                </div>
            </div>

            <div class="card">
                <h2>Sensor Readings</h2>
                <div id="sensorMetrics">
                    <div class="metric"><span>Temperature</span><span class="value" id="sensorTemp">Loading...</span></div>
                    <div class="metric"><span>Humidity</span><span class="value" id="humidity">Loading...</span></div>
                    <div class="metric"><span>Pressure</span><span class="value" id="pressure">Loading...</span></div>
                    <div class="metric"><span>Light Level</span><span class="value" id="lightLevel">Loading...</span></div>
                    <div class="metric"><span>Sound Level</span><span class="value" id="soundLevel">Loading...</span></div>
                    <div class="metric"><span>Air Quality</span><span class="value" id="airQuality">Loading...</span></div>
                </div>
            </div>

            <div class="card">
                <h2>Device Control</h2>
                <p>Control ESP32 devices and peripherals</p>
                <div style="margin-top:15px" id="deviceControls">
                    <button class="ctrl-btn" onclick="controlDevice('led', 'on')">LED ON</button>
                    <button class="ctrl-btn danger" onclick="controlDevice('led', 'off')">LED OFF</button>
                    <button class="ctrl-btn" onclick="controlDevice('relay', 'toggle')">Relay Toggle</button>
                    <button class="ctrl-btn" onclick="controlDevice('servo', 'move')">Servo Move</button>
                    <button class="ctrl-btn" onclick="controlDevice('fan', 'control')">Fan Control</button>
                    <button class="ctrl-btn" onclick="controlDevice('motor', 'start')">Motor Start</button>
                    <button class="ctrl-btn" onclick="controlDevice('buzzer', 'beep')">Buzzer</button>
                    <button class="ctrl-btn danger" onclick="controlDevice('system', 'emergency_stop')">Emergency Stop</button>
                    <button class="ctrl-btn danger" onclick="controlDevice('system', 'reset')">System Reset</button>
                </div>
                <div id="controlStatus" style="margin-top:10px;font-size:12px;color:#666;"></div>
            </div>

            <div class="card">
                <h2>Network Information</h2>
                <div id="networkMetrics">
                    <div class="metric"><span>IP Address</span><span class="value" id="ipAddress">Loading...</span></div>
                    <div class="metric"><span>MAC Address</span><span class="value" id="macAddress">Loading...</span></div>
                    <div class="metric"><span>Signal Strength</span><span class="value" id="signalStrength">Loading...</span></div>
                    <div class="metric"><span>Gateway</span><span class="value" id="gateway">Loading...</span></div>
                    <div class="metric"><span>DNS Server</span><span class="value" id="dnsServer">Loading...</span></div>
                    <div class="metric"><span>Subnet Mask</span><span class="value" id="subnetMask">Loading...</span></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>System Information</h2>
            <div class="metric"><span>Firmware Version</span><span class="value">v2.1.0</span></div>
            <div class="metric"><span>Hardware Revision</span><span class="value">ESP32-D0WDQ6</span></div>
            <div class="metric"><span>Flash Size</span><span class="value">4 MB</span></div>
            <div class="metric"><span>SRAM Size</span><span class="value">520 KB</span></div>
            <div class="metric"><span>Boot Time</span><span class="value">2.3 seconds</span></div>
            <div class="metric"><span>Last Reset</span><span class="value">Power On Reset</span></div>
            <div class="metric"><span>Compile Date</span><span class="value" id="lastUpdate">Loading...</span></div>
            <div class="metric"><span>WiFi Mode</span><span class="value">Station</span></div>
            <div class="metric"><span>Encryption</span><span class="value">WPA2-PSK</span></div>
            <div class="metric"><span>Channel</span><span class="value">6</span></div>
        </div>

        <div style="text-align:center;margin-top:30px;color:rgba(255,255,255,0.8)">
            <p>&copy; 2025 ESP32 Dashboard | Build v1.0.0 | Powered by ESP-IDF Framework</p>
            <p>Last Update: <span id="lastRefresh">Never</span> | Refresh Rate: 5 seconds</p>
        </div>
    </div>

    <script>
        let refreshInterval = null;

        // Fetch and update system data
        async function updateSystemData() {
            try {
                const response = await fetch('/api/system');
                const data = await response.json();

                if (data.system) {
                    const sys = data.system;
                    document.getElementById('deviceStatus').innerHTML =
                        '<span class="status-indicator status-online"></span>' + sys.status;
                    document.getElementById('wifiStatus').textContent = sys.wifi;
                    document.getElementById('uptime').textContent = sys.uptime;
                    document.getElementById('freeMemory').textContent = sys.freeMemory;
                    document.getElementById('cpuUsage').textContent = sys.cpuUsage;
                    document.getElementById('systemTemp').textContent = sys.temperature;
                }
            } catch (error) {
                console.error('Error fetching system data:', error);
                document.getElementById('deviceStatus').innerHTML =
                    '<span class="status-indicator status-offline"></span>Offline';
            }
        }

        // Fetch and update sensor data
        async function updateSensorData() {
            try {
                const response = await fetch('/api/sensors');
                const data = await response.json();

                if (data.sensors) {
                    const sensors = data.sensors;
                    document.getElementById('sensorTemp').textContent = sensors.temperature;
                    document.getElementById('humidity').textContent = sensors.humidity;
                    document.getElementById('pressure').textContent = sensors.pressure;
                    document.getElementById('lightLevel').textContent = sensors.lightLevel;
                    document.getElementById('soundLevel').textContent = sensors.soundLevel;
                    document.getElementById('airQuality').textContent = sensors.airQuality;
                }
            } catch (error) {
                console.error('Error fetching sensor data:', error);
            }
        }

        // Fetch and update network data
        async function updateNetworkData() {
            try {
                const response = await fetch('/api/network');
                const data = await response.json();

                if (data.network) {
                    const net = data.network;
                    document.getElementById('ipAddress').textContent = net.ipAddress;
                    document.getElementById('macAddress').textContent = net.macAddress;
                    document.getElementById('signalStrength').textContent = net.signalStrength;
                    document.getElementById('gateway').textContent = net.gateway;
                    document.getElementById('dnsServer').textContent = net.dnsServer;
                    document.getElementById('subnetMask').textContent = net.subnetMask;
                }
            } catch (error) {
                console.error('Error fetching network data:', error);
            }
        }

        // Control device function
        async function controlDevice(device, action) {
            try {
                const response = await fetch('/api/control', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ device: device, action: action })
                });

                const result = await response.json();
                const statusDiv = document.getElementById('controlStatus');

                if (result.success) {
                    statusDiv.innerHTML = `<span style="color:#48bb78;">✓ ${result.message}</span>`;
                } else {
                    statusDiv.innerHTML = `<span style="color:#f56565;">✗ ${result.message}</span>`;
                }

                // Clear status after 3 seconds
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);

            } catch (error) {
                console.error('Error controlling device:', error);
                document.getElementById('controlStatus').innerHTML =
                    '<span style="color:#f56565;">✗ Communication error</span>';
            }
        }

        // Refresh all data
        function refreshAllData() {
            updateSystemData();
            updateSensorData();
            updateNetworkData();

            // Update last refresh time
            const now = new Date();
            document.getElementById('lastRefresh').textContent = now.toLocaleTimeString();
        }

        // Auto-refresh toggle
        function toggleAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');

            if (checkbox.checked) {
                refreshInterval = setInterval(refreshAllData, 5000); // 5 seconds
            } else {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Set compile date
            document.getElementById('lastUpdate').textContent = new Date().toDateString();

            // Initial data load
            refreshAllData();

            // Set up auto-refresh
            document.getElementById('autoRefresh').addEventListener('change', toggleAutoRefresh);
            toggleAutoRefresh(); // Start auto-refresh if checkbox is checked
        });
    </script>
</body>
</html>