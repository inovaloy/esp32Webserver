# Quick Start: SD Card HTML Support

## TL;DR - Get Started in 3 Steps

### Step 1: Prepare SD Card Files
```bash
make sd-prepare
```

### Step 2: Copy to SD Card
Copy all files from `sd_card_files/html/` to a folder named `html` on your SD card root.

### Step 3: Update Your Code
Replace in `Src/esp32Webserver.ino`:

```cpp
// OLD:
#include "AutoGen/autoGenWebServer.h"
startWebServer();

// NEW:
#include "webServerSD.h"
startWebServerWithSD(true, 5);  // true = enable SD, 5 = CS pin
```

Build and flash:
```bash
make build
make flash
```

Done! Now you can edit HTML files on the SD card without recompiling.

---

## How It Works

### Before (Compiled Mode)
```
Edit HTML → Run make build → Flash ESP32 → Test
```
**Time**: ~2-5 minutes per change

### After (SD Card Mode)
```
Edit HTML → Copy to SD card → Reset ESP32 → Test
```
**Time**: ~10 seconds per change

### Best of Both Worlds
The new implementation automatically falls back to compiled HTML if:
- SD card is not inserted
- SD card fails to mount
- HTML files are missing

This means your web server always works!

---

## Example: Update login.html

### Old Way (2-5 minutes)
1. Edit `html/login.html`
2. Run `make build` (compiles everything)
3. Run `make flash` (uploads to ESP32)
4. Wait for reboot
5. Test changes

### New Way (10 seconds)
1. Edit `html/login.html`
2. Run `make sd-prepare`
3. Copy `sd_card_files/html/login.html` to SD card
4. Press reset button on ESP32
5. Test changes

---

## Development Workflow

### Daily Development (Use SD Card)
```bash
# One-time setup
make sd-prepare
# Copy to SD card

# Then for each HTML change:
# 1. Edit HTML file
# 2. Copy to SD card
# 3. Reset ESP32
```

### Production Deployment (Use Compiled)
```bash
make build
make flash
# No SD card needed in production
```

---

## Troubleshooting

### "SD Card Mount Failed"
- Check wiring (CS=5, MOSI=23, MISO=19, SCK=18)
- Verify SD card is formatted (FAT32)
- Try a different SD card

### "File not found: /html/xxx.html"
- Ensure `html` folder exists on SD card root
- Check file names match exactly (case-sensitive)
- Re-run `make sd-prepare` and copy files again

### HTML not updating
- Make sure you copied the updated file to SD card
- Press reset button on ESP32
- Check Serial Monitor for "Serving xxx from SD card" message

---

## SD Card Wiring

Default pins for ESP32:
```
SD Card    ESP32
--------   -----
CS    →    GPIO 5
MOSI  →    GPIO 23
MISO  →    GPIO 19
SCK   →    GPIO 18
VCC   →    3.3V
GND   →    GND
```

If you use a different CS pin, update in your code:
```cpp
startWebServerWithSD(true, YOUR_CS_PIN);
```

---

## Complete File Structure

### Your Computer
```
esp32Webserver/
├── html/                      ← Edit here
│   ├── index.html
│   ├── login.html
│   └── ...
└── sd_card_files/            ← Generated by make sd-prepare
    └── html/
        ├── index.html
        └── ...
```

### Your SD Card
```
SD Card Root/
└── html/                     ← Copy here
    ├── index.html
    ├── login.html
    └── ...
```

---

## Tips & Tricks

### Tip 1: Keep Compiled Version Updated
Always run `make autogen` before building to keep the compiled fallback version current:
```bash
make autogen  # Updates compiled HTML
make build    # Builds with updated fallback
```

### Tip 2: Use Both Modes
You can switch modes without recompiling:
```cpp
extern bool useSDCardForHTML;

void loop() {
    // Switch to SD mode
    useSDCardForHTML = true;

    // Switch to compiled mode
    useSDCardForHTML = false;
}
```

### Tip 3: Monitor What's Happening
Watch the Serial Monitor to see which mode is active:
```
Serving login.html from SD card      ← SD card mode
Serving login.html from compiled data ← Compiled mode
```

---

## Need More Help?

See the complete guide: `SD_CARD_USAGE.md`
